# -*- coding: utf-8 -*-
import os
import time
import numpy as np
import matplotlib.pyplot as plt
from GA import GA

fit = list()
gen = list()

class TSP(object):
	"""
	TSP类
	g_popSize 人口总数
	g_chromoLength 基因长度
	g_crossRate 交叉概率
	g_mutationRare 变异概率
	g_bestFiness 最佳适应度
	g_bestGenome 最佳个体基因
	g_pop 种群
	"""
	def __init__(self, g_popSize,g_chromolength,g_crossOverRate,g_mutationRate):
		self.g_popSize = g_popSize
		self.g_chromolength = g_chromolength
		self.g_crossOverRate = g_crossOverRate
		self.g_mutationRate = g_mutationRate
		self.g_bestFitness = -1
		self.g_bestGenome = None
		self.g_pop = GA(g_popSize,g_chromolength,g_crossOverRate,g_mutationRate)

	def StartAlg(self,t):
		global fit,gen
		newPop = self.g_pop.population
		while(self.g_pop.generation<t):
			newPop=self.g_pop.Epoch(newPop)
			fit.append(1.0/self.g_pop.bestFitness)
			gen.append(self.g_pop.generation)
			self.g_pop.generation +=1
		self.g_bestFitness = 1.0/self.g_pop.SetFitness(self.g_pop.bestGenome.gene)
		self.g_bestGenome = self.g_pop.bestGenome.gene
		self.g_bestGenome.append(1)
		self.ShowPath()

	def ShowPath(self):
		print "CrossOver Rate:",self.g_crossOverRate,"Mutation Rate",self.g_mutationRate
		print "BestFitness:",
		print self.g_bestFitness
		print "BestGenome:",
		print self.g_bestGenome
		print "Time:",time.clock()
		

def main():
	global gen,fit
	time.clock()
	tsp = TSP(100,144,0.618,0.1)
	tsp.StartAlg(10000)
	plt.plot(gen,fit)
	plt.show()

if __name__ == '__main__':
	main()


#generation = 500 popSize = 100

'''
0.85 0.0618
BestFitness: 160230.972647
BestGenome: [1, 49, 114, 113, 112, 111, 58, 46, 47, 48, 59, 77, 78, 94, 93, 95, 96, 99, 52, 51, 54, 55, 56, 57, 64, 43, 44, 117, 118, 119, 120, 102, 103, 88, 82, 81, 80, 79, 104, 105, 106, 109, 110, 86, 85, 84, 83, 131, 132, 133, 134, 127, 128, 130, 87, 60, 28, 2, 5, 6, 37, 20, 17, 41, 42, 91, 92, 116, 121, 125, 126, 124, 61, 62, 63, 65, 69, 70, 68, 67, 66, 100, 101, 115, 135, 141, 142, 144, 143, 129, 123, 122, 97, 98, 90, 89, 76, 75, 74, 73, 72, 71, 45, 38, 39, 40, 7, 9, 11, 10, 18, 16, 15, 14, 13, 12, 8, 19, 21, 108, 107, 136, 137, 138, 139, 140, 53, 50, 34, 33, 32, 31, 29, 30, 26, 23, 22, 24, 25, 36, 35, 27, 3, 4, 1]

BestFitness: 168524.697164
BestGenome: [1, 27, 26, 36, 82, 83, 84, 85, 106, 131, 132, 128, 129, 130, 134, 133, 97, 95, 94, 93, 75, 74, 73, 91, 92, 78, 77, 60, 53, 52, 51, 34, 30, 35, 46, 47, 63, 64, 65, 103, 102, 101, 66, 67, 68, 71, 45, 44, 43, 21, 40, 39, 24, 25, 37, 38, 62, 61, 59, 48, 58, 57, 56, 55, 54, 50, 49, 141, 142, 143, 144, 112, 114, 113, 111, 121, 117, 120, 119, 118, 116, 88, 31, 32, 33, 7, 9, 10, 11, 12, 20, 18, 17, 15, 13, 14, 72, 76, 89, 90, 98, 96, 99, 100, 115, 135, 136, 137, 138, 139, 140, 87, 23, 22, 6, 5, 4, 3, 28, 29, 79, 80, 81, 104, 105, 108, 109, 86, 110, 107, 127, 126, 125, 122, 123, 124, 69, 70, 42, 41, 16, 19, 8, 2, 1]
'''

'''
0.618 0.0618
BestFitness: 130891.537708
BestGenome: [1, 54, 56, 48, 59, 90, 98, 92, 91, 93, 94, 97, 96, 121, 122, 123, 124, 125, 106, 107, 86, 52, 51, 50, 49, 31, 32, 30, 35, 25, 24, 36, 57, 58, 60, 63, 64, 14, 13, 15, 16, 20, 8, 7, 9, 11, 12, 10, 19, 21, 43, 44, 45, 40, 39, 38, 37, 46, 47, 61, 62, 18, 17, 42, 41, 71, 72, 68, 67, 65, 66, 69, 70, 75, 73, 74, 95, 116, 117, 118, 119, 120, 105, 110, 109, 108, 85, 83, 55, 53, 114, 113, 112, 111, 144, 143, 142, 141, 140, 139, 138, 137, 136, 135, 134, 133, 132, 131, 115, 130, 129, 128, 127, 126, 104, 84, 82, 81, 80, 79, 103, 88, 87, 102, 101, 100, 99, 89, 76, 78, 77, 33, 34, 28, 29, 27, 26, 23, 22, 6, 5, 4, 3, 2, 1]

BestFitness: 145807.809933
BestGenome: [1, 70, 69, 68, 67, 61, 60, 83, 84, 86, 109, 108, 135, 136, 137, 125, 124, 123, 122, 121, 104, 105, 106, 107, 56, 55, 54, 111, 112, 113, 114, 52, 53, 37, 42, 41, 39, 38, 40, 7, 8, 15, 72, 91, 92, 93, 101, 103, 102, 129, 130, 128, 126, 127, 120, 119, 118, 117, 116, 99, 89, 78, 77, 76, 75, 74, 73, 71, 45, 44, 43, 66, 65, 64, 63, 62, 59, 48, 47, 46, 21, 18, 17, 16, 12, 11, 10, 9, 22, 23, 58, 57, 82, 81, 80, 79, 88, 90, 98, 97, 94, 95, 96, 100, 87, 138, 141, 142, 143, 144, 140, 139, 134, 133, 132, 131, 115, 110, 85, 51, 50, 49, 33, 34, 2, 28, 31, 32, 29, 26, 35, 25, 6, 5, 4, 3, 19, 13, 14, 20, 24, 36, 27, 30, 1]

BestFitness: 116104.333098
BestGenome: [1, 87, 102, 103, 108, 86, 85, 111, 112, 113, 114, 80, 88, 99, 90, 78, 77, 76, 75, 89, 100, 101, 98, 97, 96, 95, 74, 73, 43, 41, 16, 15, 14, 13, 12, 11, 10, 9, 21, 18, 17, 19, 8, 7, 20, 42, 66, 65, 64, 63, 62, 48, 59, 60, 81, 82, 84, 52, 50, 49, 51, 53, 54, 56, 55, 57, 58, 83, 142, 143, 144, 141, 140, 139, 138, 137, 110, 109, 107, 106, 104, 105, 115, 131, 132, 133, 130, 129, 128, 127, 124, 123, 122, 121, 120, 119, 118, 117, 116, 125, 126, 134, 136, 135, 79, 47, 46, 61, 94, 93, 92, 91, 72, 71, 45, 44, 70, 69, 68, 67, 40, 39, 38, 37, 23, 22, 6, 5, 4, 3, 2, 28, 25, 24, 30, 34, 33, 32, 31, 26, 36, 35, 27, 29, 1]

#catch distance[index1][index2] <distance[index1][index1+1]  (By swaping (index1+1,index2), random index2 10 times to find a less distance)
#Only  reducing 10,000  :-(
BestFitness: 139461.295158
BestGenome: [1, 55, 103, 102, 120, 119, 118, 117, 116, 88, 106, 107, 137, 138, 139, 114, 113, 112, 111, 126, 125, 124, 121, 122, 123, 127, 128, 129, 130, 134, 135, 136, 109, 84, 83, 58, 36, 25, 24, 6, 5, 30, 56, 57, 35, 26, 27, 29, 28, 3, 4, 22, 23, 8, 7, 9, 19, 20, 17, 16, 15, 42, 41, 18, 21, 61, 62, 63, 64, 65, 66, 67, 43, 44, 45, 71, 72, 76, 77, 78, 89, 87, 104, 105, 108, 140, 144, 143, 142, 141, 110, 86, 85, 82, 81, 80, 79, 49, 50, 51, 52, 53, 54, 31, 32, 33, 34, 48, 47, 46, 37, 38, 39, 40, 59, 60, 101, 100, 99, 98, 96, 95, 97, 90, 115, 131, 132, 133, 94, 93, 92, 91, 73, 74, 75, 68, 69, 70, 14, 13, 12, 11, 10, 2, 1]

BestFitness: 123814.934895
BestGenome: [1, 27, 26, 35, 60, 59, 48, 47, 46, 36, 25, 24, 22, 23, 37, 38, 61, 62, 63, 64, 67, 70, 71, 45, 44, 77, 93, 94, 95, 97, 98, 99, 115, 138, 139, 140, 49, 50, 51, 31, 32, 33, 34, 39, 40, 18, 17, 41, 42, 16, 15, 14, 13, 21, 20, 19, 8, 7, 9, 10, 11, 12, 43, 72, 73, 74, 75, 76, 91, 92, 120, 119, 118, 117, 116, 96, 87, 58, 57, 56, 82, 81, 80, 79, 85, 86, 110, 111, 112, 113, 114, 107, 106, 105, 108, 109, 84, 83, 52, 53, 54, 55, 101, 100, 90, 89, 78, 69, 68, 66, 65, 88, 104, 141, 142, 143, 144, 137, 136, 135, 131, 132, 133, 134, 130, 129, 128, 121, 122, 123, 124, 125, 126, 127, 102, 103, 30, 29, 4, 5, 6, 3, 28, 2, 1]

BestFitness: 104775.140575
BestGenome: [1, 26, 35, 36, 25, 24, 22, 23, 37, 38, 64, 63, 62, 39, 40, 68, 70, 71, 45, 14, 13, 15, 16, 42, 41, 17, 18, 21, 20, 19, 8, 7, 9, 10, 11, 12, 43, 44, 72, 73, 74, 93, 94, 95, 96, 92, 91, 75, 76, 69, 67, 66, 65, 61, 82, 81, 105, 104, 103, 102, 77, 78, 100, 131, 132, 133, 134, 127, 126, 125, 124, 123, 122, 121, 120, 119, 118, 117, 116, 128, 129, 130, 90, 89, 97, 98, 99, 101, 87, 88, 115, 135, 136, 137, 138, 139, 140, 141, 111, 112, 113, 114, 144, 143, 142, 110, 86, 85, 84, 83, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 109, 107, 106, 108, 80, 79, 60, 59, 48, 47, 46, 31, 32, 33, 34, 30, 27, 29, 28, 6, 5, 4, 3, 2, 1]


First time  under 100,000

CrossOver Rate: 0.66 Mutation Rate 0.1
BestFitness: 98204.6646655
BestGenome: [1, 22, 23, 24, 25, 36, 48, 87, 88, 31, 32, 33, 34, 56, 55, 54, 53, 52, 51, 50, 49, 114, 113, 112, 111, 144, 143, 142, 141, 140, 139, 138, 137, 136, 135, 107, 106, 104, 105, 108, 109, 110, 86, 85, 84, 83, 82, 81, 80, 79, 68, 67, 66, 65, 64, 63, 62, 61, 59, 60, 100, 101, 102, 103, 115, 131, 132, 133, 134, 130, 129, 128, 125, 123, 124, 127, 126, 122, 121, 120, 119, 118, 117, 116, 92, 91, 99, 90, 89, 78, 77, 69, 70, 76, 75, 98, 97, 96, 95, 94, 93, 74, 73, 72, 71, 45, 44, 43, 42, 41, 21, 18, 17, 16, 15, 14, 13, 12, 11, 10, 37, 38, 39, 40, 20, 19, 7, 9, 8, 46, 47, 58, 57, 35, 26, 27, 30, 29, 28, 4, 3, 2, 6, 5, 1]


CrossOver Rate: 0.64 Mutation Rate 0.15
BestFitness: 94780.471241
BestGenome: [1, 62, 63, 64, 65, 66, 12, 11, 10, 9, 7, 8, 19, 20, 21, 18, 17, 41, 42, 43, 72, 45, 44, 71, 73, 74, 75, 76, 91, 92, 93, 94, 99, 90, 89, 100, 101, 102, 106, 110, 86, 111, 112, 113, 114, 144, 143, 142, 141, 140, 139, 138, 137, 136, 135, 134, 130, 129, 133, 132, 131, 115, 85, 84, 83, 82, 81, 80, 77, 78, 98, 97, 96, 95, 116, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 128, 103, 88, 87, 107, 109, 108, 105, 104, 79, 46, 47, 48, 59, 60, 58, 57, 31, 32, 33, 34, 53, 54, 55, 49, 50, 51, 52, 56, 61, 67, 68, 69, 70, 14, 13, 15, 16, 40, 39, 38, 37, 23, 22, 24, 25, 36, 35, 26, 27, 30, 29, 28, 6, 5, 4, 3, 2, 1]


3000 gen
CrossOver Rate: 0.6 Mutation Rate 0.1
BestFitness: 77820.9858982
BestGenome: [1, 34, 33, 32, 31, 49, 50, 51, 52, 53, 54, 79, 80, 81, 82, 83, 84, 85, 86, 109, 108, 105, 104, 106, 107, 110, 111, 112, 113, 114, 144, 143, 142, 141, 140, 139, 138, 137, 136, 135, 134, 133, 132, 131, 115, 130, 129, 128, 127, 126, 125, 124, 123, 122, 121, 120, 119, 118, 90, 89, 78, 77, 76, 75, 74, 73, 70, 69, 68, 67, 66, 65, 64, 63, 62, 61, 21, 41, 42, 43, 44, 45, 71, 72, 91, 92, 116, 117, 96, 95, 93, 94, 97, 98, 99, 100, 101, 102, 103, 88, 87, 46, 47, 48, 59, 60, 58, 57, 56, 55, 30, 27, 26, 35, 36, 25, 24, 22, 23, 37, 38, 39, 40, 19, 20, 18, 17, 16, 15, 14, 13, 12, 11, 10, 9, 7, 8, 6, 5, 4, 3, 29, 28, 2, 1]

5000gen
CrossOver Rate: 0.618 Mutation Rate 0.1
BestFitness: 67752.2167013
BestGenome: [1, 3, 4, 5, 6, 28, 29, 30, 27, 26, 35, 36, 25, 24, 22, 23, 37, 38, 39, 40, 8, 7, 9, 10, 11, 12, 19, 20, 21, 18, 17, 41, 42, 16, 15, 13, 14, 43, 44, 45, 71, 72, 70, 69, 68, 67, 76, 75, 74, 73, 91, 92, 116, 117, 118, 119, 120, 121, 122, 123, 130, 129, 128, 127, 126, 125, 124, 99, 96, 95, 93, 94, 97, 98, 90, 89, 78, 77, 100, 101, 87, 88, 103, 102, 115, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 114, 113, 112, 111, 110, 109, 108, 107, 106, 104, 105, 86, 85, 84, 83, 82, 81, 80, 79, 66, 65, 64, 63, 62, 61, 46, 47, 48, 59, 60, 58, 57, 56, 55, 54, 53, 52, 51, 50, 49, 31, 32, 33, 34, 2, 1]

10000gen
CrossOver Rate: 0.618 Mutation Rate 0.1
BestFitness: 61139.5809566
BestGenome: [1, 2, 28, 29, 25, 24, 36, 35, 26, 27, 30, 34, 33, 32, 31, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 46, 47, 48, 59, 60, 83, 84, 82, 81, 80, 79, 87, 88, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 86, 85, 111, 112, 113, 114, 144, 143, 142, 141, 140, 139, 138, 137, 136, 135, 134, 133, 132, 131, 115, 130, 129, 128, 127, 126, 125, 124, 123, 122, 121, 120, 119, 118, 117, 116, 95, 94, 93, 92, 91, 73, 74, 75, 76, 97, 96, 98, 99, 90, 89, 78, 77, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 72, 71, 45, 44, 43, 21, 18, 17, 41, 42, 16, 15, 14, 13, 12, 11, 10, 9, 7, 8, 19, 20, 40, 39, 38, 37, 23, 22, 6, 5, 4, 3, 1]
'''
